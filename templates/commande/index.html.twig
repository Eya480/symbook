{% extends 'base.html.twig' %}

{% block title %}Passer la commande | Symbook
{% endblock %}

{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('css/homeStyle.css') }}">
{% endblock %}

{% block nav %}
	<!-- Effets de particules -->
	<div class="particles" id="particles"></div>

	<!-- Header -->
	<header class="glass-card">
		<nav class="navbar">
			<a href="#" class="logo">Symbook</a>

			<div class="nav-links">
				<a href="{{ path('home') }}">
					<i class="fas fa-home me-1"></i>Accueil</a>
				<a href="{{ path('home_livre') }}">
					<i class="fas fa-book me-1"></i>Livres</a>
				<a href="#">
					<i class="fas fa-envelope me-1"></i>Contact</a>
			</div>

			<div class="nav-actions">
				<div class="nav-links search-icon">
					<a href="{{ path('app_register') }}">
						<i class="fas fa-user-plus me-1"></i>Inscription</a>
				</div>
				<div class="search-icon">
					<i class="fas fa-search"></i>
				</div>
				<a href="{{ path('app_panier') }}" class="position-relative text-decoration-none">
					<i class="fas fa-shopping-bag fs-4 text-dark"></i>
					<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cart-counter" style="display: {{ app.session.get('panier')|length > 0 ? 'flex' : 'none' }}">
						{{ app.session.get('panier')|reduce((total, qty) => total + qty, 0) }}
					</span>
				</a>
			</div>
			<div class="hamburger">
				<i class="fas fa-bars"></i>
			</div>
		</nav>
	</header>
{% endblock %}

{% block body %}
	<div class="main-container" style="margin-top: 100px;">
		<div class="page-header">
			<h1 class="page-title">
				<i class="fas fa-shopping-cart me-2"></i>Finaliser votre commande</h1>
			<p class="page-subtitle">Vérifiez votre panier et saisissez vos informations</p>
		</div>

		{% for message in app.flashes('warning') %}
			<div class="alert alert-warning">
				<i class="fas fa-exclamation-triangle me-2"></i>
				{{ message }}
			</div>
		{% endfor %}
		{% for message in app.flashes('error') %}
			<div class="alert alert-danger">
				<i class="fas fa-exclamation-circle me-2"></i>
				{{ message }}
			</div>
		{% endfor %}

		<div class="panier-items">
			{% for item in items %}
				<div class="panier-item glass-card" style="margin-bottom: 5px;">
					<div class="panier-item-cover">
						<img src="{{ asset('Uploads/images/' ~ item.livre.image) }}" alt="{{ item.livre.titre }}">
					</div>
					<div class="panier-item-details">
						<h4>
							<i class="fas fa-book-open me-2"></i>
							{{ item.livre.titre }}</h4>
						<p class="author">
							<i class="fas fa-user-edit me-2"></i>
							{{ item.livre.editeur }}</p>
						<p class="author">
							<i class="fas fa-tag me-2"></i>Prix Unitaire:
							{{ item.livre.prix }}
							DT</p>
						<div class="panier-item-actions">
							<span class="quantity">
								<i class="fas fa-cubes me-2"></i>Quantité:
								{{ item.quantite }}</span>
							<span class="price">
								<i class="fas fa-money-bill-wave me-2"></i>Sous-total:
								{{ (item.livre.prix * item.quantite)|number_format(2) }}
								DT</span>
						</div>
					</div>
				</div>
			{% endfor %}

			<div class="panier-total glass-card">
				<h3>
					<i class="fas fa-calculator me-2"></i>Total:
					<span id="cart-total">{{ total|number_format(2) }}
						DT</span>
				</h3>
			</div>
		</div>

		<div class="commande-form glass-card">
			<h3>
				<i class="fas fa-truck me-2"></i>Informations de livraison</h3>
			<form action="{{ path('app_commande_confirmer') }}" method="POST">
				<div class="mb-3">
					<label for="adresseLivraison" class="form-label">
						<i class="fas fa-map-marker-alt me-2"></i>Adresse de livraison</label>
					<textarea class="form-control" id="adresseLivraison" name="adresseLivraison" rows="4" required placeholder="Entrez votre adresse complète"></textarea>
				</div>
				<button type="submit" class="btn btn-primary">
					<i class="fas fa-check-circle me-2"></i>Confirmer la commande</button>
				<a href="{{ path('app_panier') }}" class="btn btn-secondary">
					<i class="fas fa-arrow-left me-2"></i>Retour au panier</a>
			</form>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
	<style>
	/* Variables globales */:root
	{
		--primary-color: #007bff;
		--primary-hover: #0056b3;
		--secondary-color: #6c757d;
		--secondary-hover: #5a6268;
		--glass-bg: rgba(255, 255, 255, 0.1);
		--text-color: #fff;
		--border-radius: 10px;
		--spacing-unit: 1rem;
		--transition: all 0.3s ease;
	}

	/* Liste des articles */
	.panier-items {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-unit);
		margin-bottom: 2rem;
	}

	.panier-item {
		display: flex;
		align-items: center;
		padding: 20px;
		gap: 1rem;
		border-radius: var(--border-radius);
		border: 1px solid rgba(255, 255, 255, 0.2);
		background: var(--glass-bg);
		transition: var(--transition);
	}

	.panier-item:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	}

	.panier-item-cover {
		width: 80px;
		height: 120px;
		border-radius: 5px;
		margin-right: 10px;
		overflow: hidden;
		border: 1px solid rgba(255, 255, 255, 0.2);
	}

	.panier-item-cover img {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.panier-item-details {
		flex: 1;
	}

	.panier-item-details h4 {
		font-size: 1.25rem;
		margin: 0;
		color: var(--text-color);
		display: flex;
		align-items: center;
	}

	.panier-item-details .author {
		font-size: 0.9rem;
		color: var(--text-color);
		margin: 0.5rem 0;
		font-style: italic;
		display: flex;
		align-items: center;
	}

	.panier-item-actions {
		display: flex;
		align-items: center;
		gap: 1.5rem;
		margin-top: 0.5rem;
	}

	.quantity {
		font-size: 1rem;
		color: var(--text-color);
		display: flex;
		align-items: center;
	}

	.price {
		font-size: 1rem;
		font-weight: 500;
		color: lightblue;
		display: flex;
		align-items: center;
	}

	/* Total */
	.panier-total {
		padding: 20px;
		border-radius: var(--border-radius);
		border: 1px solid rgba(255, 255, 255, 0.2);
		background: var(--glass-bg);
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.panier-total h3 {
		margin: 0;
		font-size: 1.5rem;
		color: var(--text-color);
		display: flex;
		align-items: center;
	}

	/* Formulaire de livraison */
	.commande-form {
		padding: 2rem;
		border-radius: var(--border-radius);
		border: 1px solid rgba(255, 255, 255, 0.2);
		background: var(--glass-bg);
		margin-top: 2rem;
	}

	.commande-form h3 {
		font-size: 1.5rem;
		color: var(--text-color);
		margin-bottom: 1rem;
		display: flex;
		align-items: center;
	}

	.form-label {
		display: flex;
		align-items: center;
		color: var(--text-color);
	}

	.form-control {
		background: rgba(255, 255, 255, 0.2);
		border: 1px solid rgba(255, 255, 255, 0.3);
		color: var(--text-color);
		border-radius: var(--border-radius);
	}

	.form-control:focus {
		background: rgba(255, 255, 255, 0.3);
		border-color: var(--primary-color);
		box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
	}

	/* Boutons */
	.btn {
		padding: 0.75rem 1.5rem;
		font-size: 1rem;
		border-radius: var(--border-radius);
		transition: var(--transition);
		margin-right: 1rem;
		display: flex;
		align-items: center;
	}

	.btn-primary {
		background-color: var(--primary-color);
		border-color: var(--primary-color);
	}

	.btn-primary:hover {
		background-color: var(--primary-hover);
		border-color: var(--primary-hover);
	}

	.btn-secondary {
		background-color: var(--secondary-color);
		border-color: var(--secondary-color);
		color: black;
		width: 30%;
		margin-left: 700px;
		display: block;
	}

	.btn-secondary:hover {
		background-color: var(--secondary-hover);
		border-color: var(--secondary-hover);
	}

	/* Alertes */
	.alert {
		margin-bottom: 1rem;
		border-radius: var(--border-radius);
		display: flex;
		align-items: center;
	}

	/* Icônes */
	.fas,
	.far {
		margin-right: 0.5rem;
	}

	/* Responsivité */
	@media(max-width: 768px) {
		.panier-item {
			flex-direction: column;
			align-items: flex-start;
			text-align: center;
		}

		.panier-item-cover {
			width: 120px;
			height: 180px;
			margin: 0 auto;
		}

		.panier-item-actions {
			flex-direction: column;
			gap: 1rem;
			width: 100%;
		}

		.panier-total {
			flex-direction: column;
			gap: 1rem;
			text-align: center;
		}

		.btn {
			justify-content: center;
		}
	}
</style>{% endblock %}
